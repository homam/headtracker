{"ts":1367600459719,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<!doctype html>\n<html lang=\"en\">\n\t<head>\n\t\t<title>facetracking</title>\n\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\"/>\n\t\t<meta charset=\"utf-8\">\n\t\t<style>\n\t\t\tbody {\n\t\t\t\tbackground-color: #f0f0f0;\n\t\t\t\tmargin-left: 10%;\n\t\t\t\tmargin-right: 10%;\n\t\t\t\tmargin-top: 5%;\n\t\t\t\twidth: 40%;\n\t\t\t\toverflow: hidden;\n\t\t\t\tfont-family: \"Helvetica\", Arial, Serif;\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t#video-container {\n\t\t\t\tposition: relative;\n\t\t\t\theight: 250px;\n\t\t\t}\n\t\t\t#overlay{\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0px;\n\t\t\t\tz-index: 100001;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t\t#status-messages{\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#takephoto { \n\t\t\t\tfont-size: 120%;\n\t\t\t\ttext-decoration: none;\n\t\t\t\tcolor:blue;\n\t\t\t}\n\t\t\t#takephoto:hover{\n\t\t\t\ttext-decoration: underline;;\n\t\t\t}\n\t\t</style>\n\t</head>\n\t<body>\n\t\t<script src=\"../headtrackr.js\"></script>\n\t\t\n\t\t<div id=\"video-container\">\n\t\t\t<video id=\"vid\" autoplay loop width=\"320\" height=\"240\"></video>\n\t\t\t<canvas id=\"overlay\"></canvas>\n\t\t</div>\n\t\t<a id=\"takephoto\" href=\"javascript:void(0);\">Take a snapshot!</a>\n\t\t<img id=\"photo\" />\n\t\t\n\t\t<section id=\"status-messages\">\n\t\t\t<p id='gUMMessage'></p>\n\t\t\t<p>Status : <span id='headtrackerMessage'></span></p>\n\t\t\t<p><input type=\"button\" onclick=\"htracker.stop();htracker.start();\" value=\"reinitiate facedetection\"></input>\n\t\t</section>\n\t\t<script>\n\t\t  // set up video and canvas elements needed\n\t\t\n\t\t\tvar videoInput = document.getElementById('vid');\n\t\t\tvar canvasInput = document.createElement('canvas');\n\t\t\tcanvasInput.width = videoInput.width;\n\t\t\tcanvasInput.height = videoInput.height;\n\t\t\tvar canvasOverlay = document.getElementById('overlay');\n\t\t\tcanvasOverlay.width = videoInput.width;\n\t\t\tcanvasOverlay.height = videoInput.height;\n\t\t\tvar overlayContext = canvasOverlay.getContext('2d');\n\n\t\t\t// add some custom messaging\n\t\t\t\n\t\t\tstatusMessages = {\n\t\t\t\t\"whitebalance\" : \"checking for stability of camera whitebalance\",\n\t\t\t\t\"detecting\" : \"Detecting face\",\n\t\t\t\t\"hints\" : \"Hmm. Detecting the face is taking a long time\",\n\t\t\t\t\"redetecting\" : \"Lost track of face, redetecting\",\n\t\t\t\t\"lost\" : \"Lost track of face\",\n\t\t\t\t\"found\" : \"Tracking face\"\n\t\t\t};\n\t\t\t\n\t\t\tsupportMessages = {\n\t\t\t\t\"no getUserMedia\" : \"Unfortunately, <a href='http://dev.w3.org/2011/webrtc/editor/getusermedia.html'>getUserMedia</a> is not supported in your browser. Try <a href='http://www.opera.com/browser/'>downloading Opera 12</a> or <a href='http://caniuse.com/stream'>another browser that supports getUserMedia</a>. Now using fallback video for facedetection.\",\n\t\t\t\t\"no camera\" : \"No camera found. Using fallback video for facedetection.\"\n\t\t\t};\n\t\t\t\n\t\t\tdocument.addEventListener(\"headtrackrStatus\", function(event) {\n\t\t\t\tif (event.status in supportMessages) {\n\t\t\t\t\tvar messagep = document.getElementById('gUMMessage');\n\t\t\t\t\tmessagep.innerHTML = supportMessages[event.status];\n\t\t\t\t} else if (event.status in statusMessages) {\n\t\t\t\t\tvar messagep = document.getElementById('headtrackerMessage');\n\t\t\t\t\tmessagep.innerHTML = statusMessages[event.status];\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\t\n\t\t\t// the face tracking setup\n\t\t\t\n\t\t\tvar htracker = new headtrackr.Tracker({calcAngles : true, ui : false, headPosition : false});\n\t\t\thtracker.init(videoInput, canvasInput);\n\t\t\thtracker.start();\n\n\t\t\tvar gradhat = new Image();\n\t\t\tgradhat.src = \"gradhat.png\";\n\t\t\tgradhat.addEventListener('load', function() {\n\t\t\t\tconsole.log(gradhat.width, gradhat.height);\n\t\t\t\tgradhat.dataset.loaded = true;\n\t\t\t});\n\t\t\t\n\t\t\t// for each facetracking event received draw rectangle around tracked face on canvas\n\t\t\t\n\t\t\tdocument.addEventListener(\"facetrackingEvent\", function( event ) {\n\t\t\t\t// clear canvas\n\t\t\t\toverlayContext.clearRect(0,0,videoInput.width,videoInput.height);\n\t\t\t\t// once we have stable tracking, draw rectangle\n\t\t\t\tif (event.detection == \"CS\") {\n\t\t\t\t\toverlayContext.save();\n\t\t\t\t\toverlayContext.scale(1);\n\t\t\t\t\toverlayContext.translate(event.x, event.y)\n\t\t\t\t\toverlayContext.rotate(event.angle-(Math.PI/2));\n\t\t\t\t\t//overlayContext.strokeStyle = \"#00CC00\";\n\t\t\t\t\t//overlayContext.strokeRect((-(event.width/2)) >> 0, (-(event.height/2)) >> 0, event.width, event.height);\n\t\t\t\t\tif(!!gradhat.dataset.loaded) {\n\t\t\t\t\t\tvar hatWidth = event.width*1.8;\n\t\t\t\t\t\tvar hatHeight = gradhat.height * hatWidth/gradhat.width\n\t\t\t\t\t\toverlayContext.drawImage(gradhat,-hatWidth/2,-event.height/2-hatHeight*.66,hatWidth,hatHeight)\n\t\t\t\t\t}\n\t\t\t\t\toverlayContext.restore();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdocument.getElementById('takephoto').addEventListener('click', function(){\n\t\t\t\ttakepicture();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t  \tfunction takepicture() {\n\t\t\t    var snapshotCanvas = document.createElement(\"canvas\");\n\t\t\t    snapshotCanvas.width = videoInput.width;\n\t\t\t    snapshotCanvas.height = videoInput.height;\n\t\t\t    var snapshotContext = snapshotCanvas.getContext('2d');\n\t\t\t    snapshotContext.drawImage(videoInput, 0, 0, snapshotCanvas.width, snapshotCanvas.height);\n\t\t\t    snapshotContext.drawImage(overlay, 0, 0, snapshotCanvas.width, snapshotCanvas.height);\n\t\t\t    var data = snapshotCanvas.toDataURL('image/png');\n\t\t\t    var photo =document.getElementById('photo');\n\t\t\t    photo.src = data;\n\t\t\t}\n\t\t</script>\n\t</body>\n</html>"]],"start1":0,"start2":0,"length1":0,"length2":5067}]],"length":5067}
{"contributors":[],"silentsave":false,"ts":1367600494100,"patch":[[{"diffs":[[0,"\t\ttop: 0"],[-1,"px"],[0,";\n\t\t\t\tz-"]],"start1":489,"start2":489,"length1":18,"length2":16},{"diffs":[[0,"color:blue;\n"],[1,"                display:block;\n                margin-bottom: 1em;\n"],[0,"\t\t\t}\n\t\t\t#tak"]],"start1":659,"start2":659,"length1":24,"length2":91}]],"length":5132,"saved":false}
